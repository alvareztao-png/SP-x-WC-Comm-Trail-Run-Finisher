<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finisher Poster Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  text-align: center;
  padding: 20px;
}
input, button {
  padding: 10px;
  font-size: 16px;
  margin: 10px;
  font-family: 'Anton', sans-serif;
}
canvas {
  display: none;
  margin-top: 20px;
  max-width: 100%;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
}
</style>
</head>

<body>

<h1>Finisher Poster</h1>

<input id="nameInput" placeholder="Full Name">
<br>
<input type="file" id="photoInput" accept="image/*">
<br>
<button id="generateBtn">Generate Poster</button>

<canvas id="canvas" width="1080" height="1350"></canvas>

<script>
let participants = [];
let template = new Image();

fetch("data/participants.json")
  .then(res => res.json())
  .then(data => participants = data);

// ✅ UPDATED TEMPLATE NAME
template.src = "assets/new_template.png";

function findParticipant(name) {
  return participants.find(p =>
    p.name.toLowerCase() === name.toLowerCase()
  );
}

document.getElementById("generateBtn").addEventListener("click", generatePoster);

function generatePoster() {
  const inputName = document.getElementById("nameInput").value.trim();
  const photoFile = document.getElementById("photoInput").files[0];

  const participant = findParticipant(inputName);
  const displayName = participant ? participant.name.toUpperCase() : "";
  const bibNumber = participant ? participant.bib : "";

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  canvas.style.display = "block";

  function draw(photoImg = null) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(template, 0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#000000";
    ctx.textAlign = "left";

    // NAME
    if (displayName) {
      ctx.font = "bold 68px 'Anton'";
      ctx.fillText(displayName, 100, 600);
    }

    // BIB NUMBER (number only)
    if (bibNumber) {
      ctx.font = "bold 88px 'Anton'";
      ctx.fillText(bibNumber, 100, 690);
    }

    // ✅ PHOTO — SCALED LARGER
    if (photoImg) {
      ctx.drawImage(
        photoImg,
        660,  // X (slightly adjusted to keep balance)
        540,  // Y
        380,  // Width (larger)
        500   // Height (larger)
      );
    }
  }

  if (!template.complete) {
    template.onload = () => loadPhoto(draw);
  } else {
    loadPhoto(draw);
  }

  function loadPhoto(callback) {
    if (!photoFile) {
      callback();
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.onload = () => callback(img);
      img.src = e.target.result;
    };
    reader.readAsDataURL(photoFile);
  }
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finisher Poster Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Anton', sans-serif;
  background:#f2f2f2;
  text-align:center;
  padding:20px;
}
input, button {
  padding:12px;
  font-size:16px;
  margin:8px;
  width:90%;
  max-width:400px;
}
canvas {
  display:none;
  margin-top:20px;
  max-width:100%;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,.2);
}
</style>
</head>
<body>

<h2>Finisher Poster Generator</h2>

<input id="nameInput" placeholder="FULL NAME (as registered)">
<br>
<input type="file" id="photoInput" accept="image/*">
<br>
<button onclick="generate()">Generate Poster</button>
<br>
<a id="download" style="display:none" download>Download Poster</a>

<canvas id="canvas" width="1080" height="1350"></canvas>

<script>
const template = new Image();
template.src = "assets/finisher_template.png";

let participants = [];

fetch("data/participants.json")
  .then(res => res.json())
  .then(data => participants = data);

function generate(){
  const nameInput = document.getElementById("nameInput").value.trim().toUpperCase();
  const photoFile = document.getElementById("photoInput").files[0];
  if(!photoFile){ alert("Please upload your photo"); return; }

  const match = participants.find(p => p.name === nameInput);

  const name = match ? match.name : "";
  const bib = match ? `BIB ${match.bib}` : "";

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  canvas.style.display = "block";

  const reader = new FileReader();
  reader.onload = () => {
    const photo = new Image();
    photo.onload = () => {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(template,0,0,canvas.width,canvas.height);

      // PHOTO PLACEHOLDER AREA
      ctx.drawImage(photo, 450, 380, 500, 600);

      ctx.fillStyle = "#000";
      ctx.textAlign = "left";

      ctx.font = "60px Anton";
      if(name) ctx.fillText(name, 80, 520);

      ctx.font = "100px Anton";
      if(bib) ctx.fillText(bib, 80, 620);

      const link = document.getElementById("download");
      link.style.display = "inline-block";
      link.href = canvas.toDataURL("image/png");
      link.download = `FINISHER_${bib || "GUEST"}.png`;
    };
    photo.src = reader.result;
  };
  reader.readAsDataURL(photoFile);
}
</script>

</body>
</html>
